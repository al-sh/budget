import{r as i,E as p,a5 as h,a as j,j as s,B as E,b as S,L as F,U as C}from"./index-42a4afd0.js";import{h as A,D as N,A as x}from"./DatePicker-b93b201c.js";import{T as c,C as D}from"./TransactionTypeSelect-53df057a.js";import{F as l}from"./index-b5c30253.js";import{I as P}from"./index-7a239c1a.js";import{I as R}from"./index-b0aedb36.js";import{C as v}from"./index-eb228f41.js";import{F as w}from"./FormHeader-b04ff8d9.js";import"./Select-561e3632.js";import"./KeyCode-6413d982.js";import"./index-5763a348.js";import"./useMergedState-58b942e0.js";const q=({transaction:e})=>{const[m]=l.useForm(),[u,o]=i.useState(e!=null&&e.typeId?e.typeId:p.EXPENSE),{useItem:r}=h(),t=r("PUT",{id:(e==null?void 0:e.id)??""}),I=r("POST",{id:(e==null?void 0:e.id)??""}),g=j(),[y,T]=i.useState(!0),[f,b]=i.useState(!1);return s.jsx("div",{children:s.jsxs(l,{name:"transactionForm",form:m,labelCol:{span:8},onValuesChange:()=>{o(m.getFieldValue("typeId")),T(m.getFieldsError().filter(({errors:d})=>d.length).length>0)},layout:"horizontal",labelAlign:"left",preserve:!0,wrapperCol:{span:16},initialValues:{accountId:(e==null?void 0:e.accountId)||"",amount:!!(e!=null&&e.amount)&&(e==null?void 0:e.amount)/100||void 0,categoryId:(e==null?void 0:e.categoryId)||"",description:(e==null?void 0:e.description)||"",dt:A(e==null?void 0:e.dt)||new Date,toAccountId:(e==null?void 0:e.toAccountId)||"",typeId:(e==null?void 0:e.typeId)||p.EXPENSE},onFinish:d=>{e!=null&&e.id?t.mutate(d):I.mutate(d),m.setFieldsValue({amount:void 0,description:""}),!f&&g(-1)},autoComplete:"off",children:[s.jsx(l.Item,{label:"Дата",name:"dt",rules:[{message:"Укажите дату",required:!0}],children:s.jsx(N,{withTime:!0})}),s.jsx(l.Item,{label:"Сумма",name:"amount",rules:[{message:"Укажите сумму",required:!0}],children:s.jsx(P,{style:{width:"100%"},formatter:d=>`${d}`,parser:d=>d?d.replace(",","."):""})}),s.jsx(l.Item,{label:"Счет",name:"accountId",rules:[{message:"Выберите счет",required:!0}],children:s.jsx(x,{})}),s.jsx(l.Item,{label:"Тип",name:"typeId",rules:[{message:"Выберите тип",required:!0}],children:s.jsx(c,{})}),u===p.TRANSFER&&s.jsx(l.Item,{label:"Счет пополнения",name:"toAccountId",rules:[{message:"Выберите счет пополнения",required:!0}],children:s.jsx(x,{})}),u!==p.TRANSFER&&s.jsx(l.Item,{label:"Категория",name:"categoryId",rules:[{message:"Выберите категорию",required:!0}],children:s.jsx(D,{typeId:u})}),s.jsx(l.Item,{label:"Описание",name:"description",children:s.jsx(R,{})}),!e&&s.jsx(v,{onChange:d=>{b(d.target.checked)},children:"Создать еще"}),s.jsx(l.Item,{wrapperCol:{offset:8,span:16},children:s.jsx(E,{type:"primary",htmlType:"submit",disabled:y,children:"Сохранить"})})]})})},H=()=>{const{transactionId:e}=S(),{useGetOne:m,useItem:u}=h(),o=u("DELETE",{id:e}),{isFetching:r,data:t}=m(e||""),I=j();return s.jsxs(s.Fragment,{children:[r&&s.jsx(F,{}),e&&e!=="new"&&s.jsx(w,{text:"Редактирование транзакции",onDeleteButtonClick:()=>{confirm("Удалить транзакцию?")&&(o.mutate({}),I(C.TRANSACTIONS))}}),e==="new"&&s.jsx("div",{children:"Новая транзакция"}),!r&&s.jsx(q,{transaction:t})]})};export{H as TransactionsPage,H as default};
