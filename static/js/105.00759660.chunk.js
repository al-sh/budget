"use strict";(self.webpackChunkbudget_react=self.webpackChunkbudget_react||[]).push([[105],{3806:function(e,n,t){t.d(n,{z:function(){return o}});var r=t(1413),i=t(4964),a=t(184),o=function(e){var n=Object.assign({},e),t={background:"primary"===n.type?"linear-gradient(180deg, #008f8c 0%, #0fc2c0 100%)":"",border:"none"};return(0,a.jsx)(i.Z,(0,r.Z)((0,r.Z)({},n),{},{style:t}))}},5734:function(e,n,t){t.d(n,{M:function(){return u}});var r=t(3506),i=(t(3333),t(8163)),a=t(1049),o=t(184),u=function(e){var n=e.withTime,t=e.onChange,u=e.value,l=e.placeholder;return(0,o.jsx)(r.Z,{format:n?a.b.dateMoment.withTime:a.b.dateMoment.short,locale:i.Z,showTime:n,placeholder:l||"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0430\u0442\u0443",value:u,onChange:t})}},9921:function(e,n,t){t.d(n,{V:function(){return a}});var r,i=t(168),a=t(5751).ZP.div(r||(r=(0,i.Z)(["\n  height: 64px;\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(180deg, #008f8c 0%, #0fc2c0 100%);\n  border-radius: 0px 0px 5px 5px;\n  padding: 12px;\n"])))},3098:function(e,n,t){t.d(n,{G:function(){return a}});var r,i=t(168),a=t(5751).ZP.div(r||(r=(0,i.Z)(["\n  font-weight: 700;\n  font-size: 16px;\n  line-height: 19px;\n  color: ",";\n"])),(function(e){return e.theme.text.header}))},3570:function(e,n,t){t.d(n,{$:function(){return o},P:function(){return a}});var r=t(6818),i=t(184),a=function(e){var n=e.allowClear,t=e.children,a=e.disabled,o=e.loading,u=e.value,l=e.onChange;return(0,i.jsx)(r.Z,{allowClear:n,disabled:a,loading:o,value:0!=u?u:void 0,onChange:l,children:t})},o=function(e){var n=e.children;return(0,i.jsx)(r.Z.Option,{children:n})}},7556:function(e,n,t){t.d(n,{L:function(){return m}});var r,i=t(168),a=t(5751),o=t(2791),u=["title","titleId"];function l(){return l=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},l.apply(this,arguments)}function c(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function d(e,n){var t=e.title,i=e.titleId,a=c(e,u);return o.createElement("svg",l({width:30,height:24,viewBox:"0 0 30 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:n,"aria-labelledby":i},a),t?o.createElement("title",{id:i},t):null,r||(r=o.createElement("path",{d:"M15 0.480003C13.815 0.480003 12.82 1.30251 12.5325 2.4H0.920002C0.690005 2.3975 0.475003 2.5175 0.357499 2.7175C0.242497 2.9175 0.242497 3.1625 0.357499 3.3625C0.474997 3.5625 0.689998 3.6825 0.920002 3.68H12.5325C12.82 4.77749 13.815 5.6 15 5.6C16.185 5.6 17.18 4.77749 17.4675 3.68H29.08C29.31 3.6825 29.525 3.5625 29.6425 3.3625C29.7575 3.1625 29.7575 2.9175 29.6425 2.7175C29.525 2.5175 29.31 2.3975 29.08 2.4H17.4675C17.18 1.30251 16.185 0.480003 15 0.480003V0.480003ZM15 1.76C15.695 1.76 16.2425 2.295 16.2725 2.98251C16.27 3.02 16.27 3.06 16.2725 3.1C16.2425 3.785 15.695 4.32 15 4.32C14.305 4.32 13.7575 3.785 13.7275 3.0975C13.73 3.06 13.73 3.02 13.7275 2.98C13.7575 2.295 14.305 1.76 15 1.76ZM23.96 9.44C22.775 9.44 21.78 10.2625 21.4925 11.36H0.920002C0.690005 11.3575 0.475003 11.4775 0.357499 11.6775C0.242497 11.8775 0.242497 12.1225 0.357499 12.3225C0.474997 12.5225 0.689998 12.6425 0.920002 12.64H21.4925C21.78 13.7375 22.775 14.56 23.96 14.56C25.145 14.56 26.14 13.7375 26.4275 12.64H29.08C29.31 12.6425 29.525 12.5225 29.6425 12.3225C29.7575 12.1225 29.7575 11.8775 29.6425 11.6775C29.525 11.4775 29.31 11.3575 29.08 11.36H26.4275C26.14 10.2625 25.145 9.44 23.96 9.44ZM23.96 10.72C24.655 10.72 25.2025 11.255 25.2325 11.9425C25.23 11.98 25.23 12.02 25.2325 12.06C25.2025 12.745 24.655 13.28 23.96 13.28C23.265 13.28 22.7175 12.745 22.6875 12.0575C22.69 12.02 22.69 11.98 22.6875 11.94C22.7175 11.255 23.265 10.72 23.96 10.72ZM7.96 18.4C6.775 18.4 5.78 19.2225 5.4925 20.32H0.920002C0.690005 20.3175 0.475003 20.4375 0.357499 20.6375C0.242497 20.8375 0.242497 21.0825 0.357499 21.2825C0.474997 21.4825 0.689998 21.6025 0.920002 21.6H5.4925C5.78 22.6975 6.775 23.52 7.96 23.52C9.145 23.52 10.14 22.6975 10.4275 21.6H29.08C29.31 21.6025 29.525 21.4825 29.6425 21.2825C29.7575 21.0825 29.7575 20.8375 29.6425 20.6375C29.525 20.4375 29.31 20.3175 29.08 20.32H10.4275C10.14 19.2225 9.145 18.4 7.96 18.4ZM7.96 19.68C8.655 19.68 9.2025 20.215 9.2325 20.9025C9.23 20.94 9.23 20.98 9.2325 21.02C9.2025 21.705 8.655 22.24 7.96 22.24C7.265 22.24 6.7175 21.705 6.6875 21.0175C6.69 20.98 6.69 20.94 6.6875 20.9C6.71751 20.215 7.265 19.68 7.96 19.68Z",fill:"white"})))}var s,f,h=o.forwardRef(d),v=(t.p,t(184)),p=a.ZP.div(s||(s=(0,i.Z)(["\n  cursor: pointer;\n  position: relative;\n"]))),g=a.ZP.span(f||(f=(0,i.Z)(["\n  position: absolute;\n  height: 16px;\n  width: 16px;\n  padding-left: 4px;\n  bottom: 0px;\n  right: -5px;\n  border-radius: 8px;\n  line-height: 18px;\n  background-color: ",";\n  color: ",";\n"])),(function(e){return e.theme.background.main}),(function(e){return e.theme.text.active})),m=function(e){var n=e.showFilters,t=e.onClick,r=e.filtersCount;return(0,v.jsxs)(p,{children:[(0,v.jsx)(h,{onClick:t,children:n?"\u0421\u043a\u0440\u044b\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b"}),!!r&&(0,v.jsx)(g,{children:r})]})}},4034:function(e,n,t){t.d(n,{X:function(){return o}});var r=t(7583),i=t(3570),a=t(184),o=function(e){var n=e.allowClear,t=e.value,o=e.onChange,u=(0,r.x)().useGetAccountsList(!1),l=u.isLoading,c=u.data;return(0,a.jsx)(i.P,{loading:l,allowClear:n,value:t,onChange:o,children:null===c||void 0===c?void 0:c.map((function(e){return(0,a.jsx)(i.$,{value:e.id,children:e.name},e.id)}))})}},8920:function(e,n,t){t.d(n,{J:function(){return o}});var r=t(3766),i=t(1519),a=t(184),o=function(e){var n=e.typeId,t=e.onChange,o=e.value,u=e.allowClear,l=e.disabled,c=(0,i.L)().useGetTree({typeId:n}),d=c.isLoading,s=c.data;return(0,a.jsx)(r.Z,{treeData:s,allowClear:u,loading:d,disabled:l||!n,onChange:t,value:0!=o?o:void 0,dropdownStyle:{overflow:"auto"},treeDefaultExpandAll:!0})}},7338:function(e,n,t){t.d(n,{S:function(){return c}});var r=t(1933),i=t(3840),a=[{id:i.K.EXPENSE,name:"\u0420\u0430\u0441\u0445\u043e\u0434"},{id:i.K.INCOME,name:"\u0414\u043e\u0445\u043e\u0434"},{id:i.K.RETURN_EXPENSE,name:"\u0412\u043e\u0437\u0432\u0440\u0430\u0442 \u0440\u0430\u0441\u0445\u043e\u0434\u0430"},{id:i.K.RETURN_INCOME,name:"\u0412\u043e\u0437\u0432\u0440\u0430\u0442 \u0434\u043e\u0445\u043e\u0434\u0430"},{id:i.K.TRANSFER,name:"\u041f\u0435\u0440\u0435\u0432\u043e\u0434 \u043c\u0435\u0436\u0434\u0443 \u0441\u0432\u043e\u0438\u043c\u0438 \u0441\u0447\u0435\u0442\u0430\u043c\u0438"}],o=function(e){return(0,r.useQuery)(["transactionTypes",e],(function(){return function(e){return new Promise((function(n){n(e?a.filter((function(e){return e.id!==i.K.RETURN_EXPENSE&&e.id!==i.K.RETURN_INCOME})):a)}))}(!!e)}))},u=t(3570),l=t(184),c=function(e){var n=e.allowClear,t=e.value,r=e.hideReturns,i=e.disabled,a=e.onChange,c=o(r),d=c.isLoading,s=c.data;return(0,l.jsx)(u.P,{allowClear:n,loading:d,onChange:a,value:t,disabled:i,children:(null===s||void 0===s?void 0:s.length)&&(null===s||void 0===s?void 0:s.map((function(e){return(0,l.jsx)(u.$,{value:e.id,children:e.name},e.id)})))})}},7105:function(e,n,t){t.r(n),t.d(n,{TransactionsPage:function(){return H},default:function(){return D}});var r,i=t(1413),a=t(9439),o=t(2791),u=t(4829),l=t(3840),c=t(4034),d=t(8920),s=t(7338),f=t(3806),h=t(5734),v=t(184),p=function(e){var n=e.params,t=e.onClear,r=e.onFinish,i=u.Z.useForm(),p=(0,a.Z)(i,1)[0],g=(0,o.useState)(n.typeId?n.typeId:void 0),m=(0,a.Z)(g,2),C=m[0],x=m[1],y=(0,o.useState)(!1),j=(0,a.Z)(y,2),Z=j[0],w=j[1];return(0,v.jsx)("div",{children:(0,v.jsxs)(u.Z,{name:"TransactionsFilters",form:p,onValuesChange:function(){x(p.getFieldValue("typeId")),w(p.getFieldsError().filter((function(e){return e.errors.length})).length>0)},layout:"horizontal",labelAlign:"left",initialValues:n,onFinish:function(e){r(e)},autoComplete:"off",children:[(0,v.jsxs)("div",{style:{marginTop:20,display:"flex",alignItems:"baseline"},children:[(0,v.jsx)(u.Z.Item,{name:"dateFrom",style:{display:"inline-block"},children:(0,v.jsx)(h.M,{placeholder:"\u041d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430"})}),(0,v.jsx)("span",{style:{margin:"0 12px 0 12px"},children:"-"}),(0,v.jsx)(u.Z.Item,{name:"dateEnd",style:{display:"inline-block"},children:(0,v.jsx)(h.M,{placeholder:"\u041a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430"})})]}),(0,v.jsx)(u.Z.Item,{label:"\u0421\u0447\u0435\u0442",name:"accountId",children:(0,v.jsx)(c.X,{allowClear:!0})}),(0,v.jsx)(u.Z.Item,{label:"\u0422\u0438\u043f",name:"typeId",children:(0,v.jsx)(s.S,{allowClear:!0,onChange:function(){p.setFieldsValue({categoryId:void 0})}})}),C!==l.K.TRANSFER&&(0,v.jsx)(u.Z.Item,{label:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",name:"categoryId",children:(0,v.jsx)(d.J,{typeId:C})}),(0,v.jsx)(u.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,v.jsxs)("div",{children:[(0,v.jsx)(f.z,{type:"link",onClick:function(){t()},children:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c"}),(0,v.jsx)(f.z,{type:"primary",htmlType:"submit",disabled:Z,children:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c"})]})})]})})},g=t(3433),m=t(145),C=t(168),x=t(32),y=t(5751),j=t(155),Z=t(5971),w=y.ZP.div(r||(r=(0,C.Z)(["\n  margin: 20px 0 20px 0;\n"]))),I=(0,x.Pi)((function(e){var n=e.date,t=e.transactions;return(0,v.jsxs)(w,{children:[(0,v.jsx)(j.T1,{children:n}),t.map((function(e){return(0,v.jsx)(Z.A,{tran:e,showOnlyTime:!0},e.id)}))]})}));I.displayName="TransactionsGroup";var b=function(e){var n=e.transactions,t=(0,o.useMemo)((function(){return function(e){for(var n=new Map,t=0;t<e.length;t++){var r,i=(0,m.OY)(e[t].dt);n.get(i)||n.set(i,[]),null===(r=n.get(i))||void 0===r||r.push(e[t])}return n}(n||[])}),[JSON.stringify(n)]),r=(0,g.Z)(t.keys());return(0,v.jsx)(v.Fragment,{children:r.length>0&&r.map((function(e){return(0,v.jsx)(I,{date:e,transactions:t.get(e)||[]},e)}))})},E=t(4964),S=t(2426),T=t.n(S),M=t(3504),P=t(1049),O=t(6909),F=t(7556),k=t(1871),N=t(9921),R=t(3098),H=function(){var e=(0,o.useState)(!1),n=(0,a.Z)(e,2),t=n[0],r=n[1],u=(0,o.useState)(0),l=(0,a.Z)(u,2),c=l[0],d=l[1],s=(0,M.lr)(),f=(0,a.Z)(s,2),h=f[0],g=f[1],m=Object.fromEntries(new URLSearchParams(h)),C={typeId:m.typeId?parseInt(m.typeId):void 0};if("undefined"!==String(m.categoryId)&&(C.categoryId=m.categoryId),"undefined"!==String(m.accountId)&&(C.accountId=m.accountId),"undefined"!==String(m.dateFrom))C.dateFrom=T()(m.dateFrom);else{var x=new Date;x.setDate(1),C.dateFrom=T()(x)}"undefined"!==String(m.dateEnd)&&(C.dateEnd=T()(m.dateEnd));var y=(0,o.useState)(C),j=(0,a.Z)(y,2),Z=j[0],w=j[1],I=(0,(0,O.n)().useGetList)(Z),S=I.isLoading,H=I.isError,D=I.data,_=0;for(var A in Z)Z[A]&&_++;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(N.V,{children:[(0,v.jsx)(R.G,{children:"\u0418\u0441\u0442\u043e\u0440\u0438\u044f"}),(0,v.jsx)(F.L,{onClick:function(){r(!t)},showFilters:t,filtersCount:_})]}),t&&(0,v.jsx)(p,{params:Z,onClear:function(){r(!1),w((0,i.Z)({},{}))},onFinish:function(e){r(!1),w(e);var n={};for(var t in e)if(void 0!==e[t]){var a=t;n[a]=e[a]}g((0,i.Z)((0,i.Z)((0,i.Z)({},n),n.dateFrom&&{dateFrom:n.dateFrom.format(P.b.dateMoment.short)}),n.dateEnd&&{dateEnd:n.dateEnd.format(P.b.dateMoment.short)}))}}),H&&(0,v.jsx)(v.Fragment,{children:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439"}),S&&(0,v.jsx)("div",{style:{textAlign:"center",width:"100%"},children:(0,v.jsx)(k.a,{size:"large"})}),D&&(0,v.jsx)(b,{transactions:D}),(0,v.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,v.jsxs)("span",{style:{marginRight:"0.5rem"},children:["\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430: ",c+1]}),c>0&&(0,v.jsx)(E.Z,{onClick:function(){d(c-1)},children:"\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0430\u044f"}),(0,v.jsx)(E.Z,{onClick:function(){d(c+1)},children:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f"})]})]})},D=H},1049:function(e,n,t){t.d(n,{b:function(){return r}});var r={date:{short:"yyyy-MM-dd",withTime:"YYYY-MM-dd HH:mm",time:"HH:mm"},dateMoment:{short:"yyyy-MM-DD",withTime:"YYYY-MM-DD HH:mm"}}},1519:function(e,n,t){t.d(n,{L:function(){return g}});var r=t(5861),i=t(7757),a=t.n(i),o=t(1933),u=t(1413),l=t(5671),c=t(3144),d=t(2810),s=t(3840),f=t(4467),h=t(145),v=function(){function e(){var n=this;(0,l.Z)(this,e),this._localDataService=(0,f.X)(),this.create=function(e){return new Promise((function(t){var r,i,a,o=n._localDataService.categories;o.push({id:(0,d.Z)(),isActive:!e.isActive||e.isActive,mpath:"",name:e.name?e.name:"",order:e.order?e.order:0,parentCategoryId:null!==(r=e.parentCategory)&&void 0!==r&&r.id?e.parentCategory.id:null,typeId:null!==(i=e.type)&&void 0!==i&&i.id?null===(a=e.type)||void 0===a?void 0:a.id:s.K.EXPENSE}),n._localDataService.categories=o.sort((function(e,n){return e.order-n.order})),t()}))},this.delete=function(e){return new Promise((function(t,r){var i=n._localDataService.categories,a=i.findIndex((function(n){return n.id===e}));if(-1!==a){var o=n._localDataService.transactions.filter((function(n){return n.categoryId===e}));o.length?(alert("\u0421\u0447\u0435\u0442 \u0441\u0434\u0435\u043b\u0430\u043d \u043d\u0435\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u043c, \u0430 \u043d\u0435 \u0443\u0434\u0430\u043b\u0451\u043d, \u0442.\u043a. \u043f\u043e \u0441\u0447\u0435\u0442\u0443 \u0431\u044b\u043b\u0438 \u043d\u0430\u0439\u0434\u0435\u043d\u044b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438. \n\u0414\u0430\u0442\u044b:\n"+o.map((function(e){return(0,h.E7)(e.dt)})).join("\n")),i[a].isActive=!1):(console.log("category delete",a),i.splice(a,1)),n._localDataService.categories=i,t()}else r("category delete, id not found:"+e)}))},this.getOne=function(e){return n._localDataService.categories.find((function(n){return n.id===e}))},this.getTree=function(e,t){return new Promise((function(r){var i=n._localDataService.categories.filter((function(n){var r=!0;if(e){var i=e;e===s.K.RETURN_EXPENSE&&(i=s.K.EXPENSE),e===s.K.RETURN_INCOME&&(i=s.K.INCOME),n.typeId!==i&&(r=!1)}return t||n.isActive||(r=!1),r}));r(i.filter((function(e){return null===e.parentCategoryId})).map((function(e){var t=i.filter((function(n){return e.id===n.parentCategoryId})).map((function(e){return n.transformCategoryToTreeItem(e)}));return(0,u.Z)((0,u.Z)({},n.transformCategoryToTreeItem(e)),{},{children:t})})))}))},this.transformCategoryToTreeItem=function(e){return{id:e.id,key:e.id,value:e.id,isActive:e.isActive,title:e.name}},this.update=function(e,t){return new Promise((function(r,i){var a=n._localDataService.categories,o=a.findIndex((function(n){return n.id===e}));if(-1===o)return console.error("categoryToUpdateIdx not found",e,t),void i();a.splice(o,1),a.push((0,u.Z)((0,u.Z)({},t),{},{id:e})),n._localDataService.categories=a.sort((function(e,n){return e.order-n.order})),r()}))}}return(0,c.Z)(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();v.instance=void 0;var p="categories",g=function(){var e=(0,o.useQueryClient)(),n=v.getInstance();return{useCreate:function(){return(0,o.useMutation)((function(e){return n.create(e)}),{onSuccess:function(){e.invalidateQueries(p)}})},useGetTree:function(e){var t=e.typeId,r=e.showHidden;return(0,o.useQuery)([p,"tree",t,r],(function(){return n.getTree(t,r)}))},useGetOne:function(e){return(0,o.useQuery)([p,e],(function(){return n.getOne(e)}),{enabled:!!e})},useItem:function(t,i,u){return(0,o.useMutation)((function(e){return"PUT"===t?n.update(i,e):n.delete(i)}),{onSuccess:function(){var n=(0,r.Z)(a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("useItem onSuccess",t),n.next=3,e.cancelQueries(p);case 3:e.invalidateQueries([p,i]),e.invalidateQueries(p),u&&u();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()})}}}}}]);
//# sourceMappingURL=105.00759660.chunk.js.map