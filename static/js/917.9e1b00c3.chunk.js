"use strict";(self.webpackChunkbudget_react=self.webpackChunkbudget_react||[]).push([[917],{3570:function(e,n,t){t.d(n,{$:function(){return o},P:function(){return a}});var r=t(6818),i=t(184),a=function(e){var n=e.allowClear,t=e.children,a=e.disabled,o=e.loading,u=e.value,c=e.onChange;return(0,i.jsx)(r.Z,{allowClear:n,disabled:a,loading:o,value:0!=u?u:void 0,onChange:c,children:t})},o=function(e){var n=e.children;return(0,i.jsx)(r.Z.Option,{children:n})}},8920:function(e,n,t){t.d(n,{J:function(){return o}});var r=t(3766),i=t(1519),a=t(184),o=function(e){var n=e.typeId,t=e.onChange,o=e.value,u=e.allowClear,c=e.disabled,s=(0,i.L)().useGetTree({typeId:n}),l=s.isLoading,d=s.data;return(0,a.jsx)(r.Z,{treeData:d,allowClear:u,loading:l,disabled:c||!n,onChange:t,value:0!=o?o:void 0,dropdownStyle:{overflow:"auto"},treeDefaultExpandAll:!0})}},7338:function(e,n,t){t.d(n,{S:function(){return s}});var r=t(1933),i=t(3840),a=[{id:i.K.EXPENSE,name:"\u0420\u0430\u0441\u0445\u043e\u0434"},{id:i.K.INCOME,name:"\u0414\u043e\u0445\u043e\u0434"},{id:i.K.RETURN_EXPENSE,name:"\u0412\u043e\u0437\u0432\u0440\u0430\u0442 \u0440\u0430\u0441\u0445\u043e\u0434\u0430"},{id:i.K.RETURN_INCOME,name:"\u0412\u043e\u0437\u0432\u0440\u0430\u0442 \u0434\u043e\u0445\u043e\u0434\u0430"},{id:i.K.TRANSFER,name:"\u041f\u0435\u0440\u0435\u0432\u043e\u0434 \u043c\u0435\u0436\u0434\u0443 \u0441\u0432\u043e\u0438\u043c\u0438 \u0441\u0447\u0435\u0442\u0430\u043c\u0438"}],o=function(e){return(0,r.useQuery)(["transactionTypes",e],(function(){return function(e){return new Promise((function(n){n(e?a.filter((function(e){return e.id!==i.K.RETURN_EXPENSE&&e.id!==i.K.RETURN_INCOME})):a)}))}(!!e)}))},u=t(3570),c=t(184),s=function(e){var n=e.allowClear,t=e.value,r=e.hideReturns,i=e.disabled,a=e.onChange,s=o(r),l=s.isLoading,d=s.data;return(0,c.jsx)(u.P,{allowClear:n,loading:l,onChange:a,value:t,disabled:i,children:(null===d||void 0===d?void 0:d.length)&&(null===d||void 0===d?void 0:d.map((function(e){return(0,c.jsx)(u.$,{value:e.id,children:e.name},e.id)})))})}},1917:function(e,n,t){t.r(n),t.d(n,{CategoriesPage:function(){return K},default:function(){return A}});var r=t(9439),i=t(3006),a=t(4964),o=t(2791),u=t(3840),c=t(168),s=t(1413),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},d=t(4291),f=function(e,n){return o.createElement(d.Z,(0,s.Z)((0,s.Z)({},e),{},{ref:n,icon:l}))};f.displayName="EditOutlined";var v,h,g,p=o.forwardRef(f),m=t(6883),E=t(6871),y=t(5751),C=t(1569),x=t(1519),S=t(1871),Z=t(184),I=y.ZP.div(v||(v=(0,c.Z)(["\n  margin-bottom: 1em;\n\n  .ant-tree .ant-tree-node-content-wrapper {\n    cursor: default;\n  }\n"]))),j=y.ZP.span(h||(h=(0,c.Z)(["\n  color: ",";\n"])),(function(e){var n=e.theme;return e.active?n.text.primary:n.text.inactive})),T=(0,y.ZP)(p)(g||(g=(0,c.Z)(["\n  margin-left: 0.5em;\n  cursor: pointer;\n"]))),w=function(e){var n=e.showHidden,t=e.typeId,r=(0,E.s0)(),i=(0,(0,x.L)().useGetTree)({showHidden:!!n,typeId:t}),a=i.isLoading,o=i.isError,u=i.data;return a?(0,Z.jsx)(S.a,{}):o?(0,Z.jsx)(Z.Fragment,{children:"Error"}):(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(I,{children:(0,Z.jsx)(m.Z,{treeData:u,selectable:!1,titleRender:function(e){return(0,Z.jsx)("span",{children:(0,Z.jsxs)(j,{active:!!e.isActive,children:[e.title,(0,Z.jsx)(T,{onClick:function(){r("".concat(C._1.SETTINGS.CATEGORIES,"/").concat(e.key))}})]})})}})})})},N=t(4829),b=t(135),P=t(8920),R=t(7338),_=function(e){var n=e.onFinish,t=(0,(0,x.L)().useCreate)(),i=(0,E.s0)(),c=N.Z.useForm(),s=(0,r.Z)(c,1)[0],l=(0,o.useState)(u.K.EXPENSE),d=(0,r.Z)(l,2),f=d[0],v=d[1];return(0,Z.jsxs)("div",{children:[(0,Z.jsx)("div",{children:"\u041d\u043e\u0432\u0430\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"}),(0,Z.jsxs)(N.Z,{name:"basic",labelCol:{span:8},form:s,layout:"vertical",wrapperCol:{span:16},initialValues:{initialValue:0,name:"",type:{id:u.K.EXPENSE},order:1},onValuesChange:function(){v(s.getFieldValue(["type","id"]))},onFinish:function(e){t.mutate(e),console.log("query.isSuccess",e),i(C._1.SETTINGS.CATEGORIES),n()},autoComplete:"off",children:[(0,Z.jsx)(N.Z.Item,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",rules:[{message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",required:!0}],children:(0,Z.jsx)(b.Z,{})}),(0,Z.jsx)(N.Z.Item,{label:"\u0422\u0438\u043f",name:["type","id"],rules:[{message:"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0442\u0438\u043f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438",required:!0}],children:(0,Z.jsx)(R.S,{hideReturns:!0})}),(0,Z.jsx)(N.Z.Item,{label:"\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0430\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",name:["parentCategory","id"],children:(0,Z.jsx)(P.J,{typeId:f,allowClear:!0})}),(0,Z.jsx)(N.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,Z.jsx)(a.Z,{type:"primary",htmlType:"submit",disabled:t.isLoading,children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]}),t.isLoading&&(0,Z.jsx)("div",{children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445..."})]})},K=function(){var e=(0,o.useState)(!1),n=(0,r.Z)(e,2),t=n[0],c=n[1],s=(0,o.useState)(u.K.EXPENSE),l=(0,r.Z)(s,2),d=l[0],f=l[1],v=(0,o.useState)(!1),h=(0,r.Z)(v,2),g=h[0],p=h[1];return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("h2",{children:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438"}),(0,Z.jsxs)(i.Z,{defaultActiveKey:String(u.K.EXPENSE),onChange:function(e){f(parseInt(e))},children:[(0,Z.jsx)(i.Z.TabPane,{tab:"\u0420\u0430\u0441\u0445\u043e\u0434\u044b"},String(u.K.EXPENSE)),(0,Z.jsx)(i.Z.TabPane,{tab:"\u0414\u043e\u0445\u043e\u0434\u044b"},String(u.K.INCOME))]}),(0,Z.jsx)(w,{showHidden:g,typeId:d}),!g&&(0,Z.jsx)(a.Z,{onClick:function(){p(!0)},children:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043a\u0440\u044b\u0442\u044b\u0435"}),(0,Z.jsx)(a.Z,{onClick:function(){c(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),t&&(0,Z.jsx)(_,{onFinish:function(){c(!1)}})]})},A=K},1519:function(e,n,t){t.d(n,{L:function(){return p}});var r=t(5861),i=t(7757),a=t.n(i),o=t(1933),u=t(1413),c=t(5671),s=t(3144),l=t(2810),d=t(3840),f=t(4467),v=t(145),h=function(){function e(){var n=this;(0,c.Z)(this,e),this._localDataService=(0,f.X)(),this.create=function(e){return new Promise((function(t){var r,i,a,o=n._localDataService.categories;o.push({id:(0,l.Z)(),isActive:!e.isActive||e.isActive,mpath:"",name:e.name?e.name:"",order:e.order?e.order:0,parentCategoryId:null!==(r=e.parentCategory)&&void 0!==r&&r.id?e.parentCategory.id:null,typeId:null!==(i=e.type)&&void 0!==i&&i.id?null===(a=e.type)||void 0===a?void 0:a.id:d.K.EXPENSE}),n._localDataService.categories=o.sort((function(e,n){return e.order-n.order})),t()}))},this.delete=function(e){return new Promise((function(t,r){var i=n._localDataService.categories,a=i.findIndex((function(n){return n.id===e}));if(-1!==a){var o=n._localDataService.transactions.filter((function(n){return n.categoryId===e}));o.length?(alert("\u0421\u0447\u0435\u0442 \u0441\u0434\u0435\u043b\u0430\u043d \u043d\u0435\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u043c, \u0430 \u043d\u0435 \u0443\u0434\u0430\u043b\u0451\u043d, \u0442.\u043a. \u043f\u043e \u0441\u0447\u0435\u0442\u0443 \u0431\u044b\u043b\u0438 \u043d\u0430\u0439\u0434\u0435\u043d\u044b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438. \n\u0414\u0430\u0442\u044b:\n"+o.map((function(e){return(0,v.E7)(e.dt)})).join("\n")),i[a].isActive=!1):(console.log("category delete",a),i.splice(a,1)),n._localDataService.categories=i,t()}else r("category delete, id not found:"+e)}))},this.getOne=function(e){return n._localDataService.categories.find((function(n){return n.id===e}))},this.getTree=function(e,t){return new Promise((function(r){var i=n._localDataService.categories.filter((function(n){var r=!0;if(e){var i=e;e===d.K.RETURN_EXPENSE&&(i=d.K.EXPENSE),e===d.K.RETURN_INCOME&&(i=d.K.INCOME),n.typeId!==i&&(r=!1)}return t||n.isActive||(r=!1),r}));r(i.filter((function(e){return null===e.parentCategoryId})).map((function(e){var t=i.filter((function(n){return e.id===n.parentCategoryId})).map((function(e){return n.transformCategoryToTreeItem(e)}));return(0,u.Z)((0,u.Z)({},n.transformCategoryToTreeItem(e)),{},{children:t})})))}))},this.transformCategoryToTreeItem=function(e){return{id:e.id,key:e.id,value:e.id,isActive:e.isActive,title:e.name}},this.update=function(e,t){return new Promise((function(r,i){var a=n._localDataService.categories,o=a.findIndex((function(n){return n.id===e}));if(-1===o)return console.error("categoryToUpdateIdx not found",e,t),void i();a.splice(o,1),a.push((0,u.Z)((0,u.Z)({},t),{},{id:e})),n._localDataService.categories=a.sort((function(e,n){return e.order-n.order})),r()}))}}return(0,s.Z)(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();h.instance=void 0;var g="categories",p=function(){var e=(0,o.useQueryClient)(),n=h.getInstance();return{useCreate:function(){return(0,o.useMutation)((function(e){return n.create(e)}),{onSuccess:function(){e.invalidateQueries(g)}})},useGetTree:function(e){var t=e.typeId,r=e.showHidden;return(0,o.useQuery)([g,"tree",t,r],(function(){return n.getTree(t,r)}))},useGetOne:function(e){return(0,o.useQuery)([g,e],(function(){return n.getOne(e)}),{enabled:!!e})},useItem:function(t,i,u){return(0,o.useMutation)((function(e){return"PUT"===t?n.update(i,e):n.delete(i)}),{onSuccess:function(){var n=(0,r.Z)(a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("useItem onSuccess",t),n.next=3,e.cancelQueries(g);case 3:e.invalidateQueries([g,i]),e.invalidateQueries(g),u&&u();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()})}}}}}]);
//# sourceMappingURL=917.9e1b00c3.chunk.js.map